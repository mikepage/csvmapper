{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://csvmapper.example.com/schemas/mapping.schema.json",
  "title": "CSV Mapping Configuration",
  "description": "Schema for CSV column mapping and transformation configuration",
  "type": "object",
  "required": ["version", "mappings"],
  "$defs": {
    "Delimiter": {
      "type": "string",
      "enum": [",", ";", "\t"],
      "default": ";",
      "description": "CSV delimiter character"
    },
    "DataType": {
      "type": "string",
      "enum": ["string", "integer", "number", "boolean"],
      "description": "Data types based on JSON Schema: https://json-schema.org/understanding-json-schema/reference"
    },
    "DecimalSeparator": {
      "type": "string",
      "enum": [".", ","],
      "default": ".",
      "description": "Decimal separator for number parsing. Thousand separators are always removed."
    },
    "Transformation": {
      "type": "string",
      "pattern": "^(uppercase|lowercase|trim|dateFormat:.+|date(:[^:]+)?(:[^:]+)?)$",
      "description": "Value transformations: uppercase, lowercase, trim, dateFormat:FORMAT, or date[:sourceFormat][:targetFormat]. Date defaults to yyyy-MM-dd for both. Tokens: yyyy, MM, dd, HH, mm, ss. Invalid dates output empty.",
      "examples": ["uppercase", "lowercase", "trim", "date", "date:dd/MM/yyyy", "date:dd/MM/yyyy:yyyy-MM-dd"]
    },
    "ColumnMapping": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "type": "string" }
      },
      "description": "Record<string, string> - source column (key) maps to target column (value)"
    },
    "TypeTransformationMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/DataType" }
      },
      "description": "Record<string, DataType> - column (key) maps to data type (value)"
    },
    "TransformationMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/Transformation" }
      },
      "description": "Record<string, Transformation> - column (key) maps to transformation (value)"
    },
    "ValueConversionMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "type": "string" }
      },
      "description": "Record<string, string> - source value (key) maps to target value (value)"
    },
    "ColumnValueConversions": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/ValueConversionMap" }
      },
      "description": "Record<string, ValueConversionMap> - column (key) maps to value conversions (value)"
    }
  },
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version"
    },
    "inputDelimiter": {
      "$ref": "#/$defs/Delimiter",
      "description": "Delimiter used in the input CSV"
    },
    "outputDelimiter": {
      "$ref": "#/$defs/Delimiter",
      "description": "Delimiter to use in the output CSV"
    },
    "decimalSeparator": {
      "$ref": "#/$defs/DecimalSeparator",
      "description": "Decimal separator for parsing numbers (. or ,). Thousand separators are always removed."
    },
    "mappings": {
      "$ref": "#/$defs/ColumnMapping",
      "description": "Column mappings. Only columns listed are included in output."
    },
    "typeTransformations": {
      "$ref": "#/$defs/TypeTransformationMap",
      "description": "Data type transformations per column"
    },
    "transformations": {
      "$ref": "#/$defs/TransformationMap",
      "description": "Value transformations per column"
    },
    "valueConversions": {
      "$ref": "#/$defs/ColumnValueConversions",
      "description": "Value conversions per column. Maps specific input values to output values."
    }
  },
  "examples": [
    {
      "version": "1.0",
      "inputDelimiter": ";",
      "outputDelimiter": ";",
      "decimalSeparator": ",",
      "mappings": {
        "id": "ID",
        "title": "gender",
        "name": "fullName",
        "active": "isActive",
        "score": "totalScore",
        "created": "createdDate"
      },
      "typeTransformations": {
        "id": "integer",
        "active": "boolean",
        "score": "number"
      },
      "transformations": {
        "name": "uppercase",
        "created": "date:dd/MM/yyyy:yyyy-MM-dd"
      },
      "valueConversions": {
        "title": {
          "Mr": "male",
          "Ms": "female",
          "Mrs": "female"
        }
      }
    }
  ]
}
