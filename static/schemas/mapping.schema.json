{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://csvmapper.mikepage.deno.net/schemas/mapping.schema.json",
  "title": "CSV Mapping Configuration",
  "description": "Schema for CSV column mapping and transformation configuration",
  "type": "object",
  "required": ["version", "mappings"],
  "$defs": {
    "Delimiter": {
      "type": "string",
      "enum": [",", ";", "\t"],
      "default": ";",
      "description": "CSV delimiter character"
    },
    "DataType": {
      "type": "string",
      "enum": ["string", "integer", "number", "boolean"],
      "description": "Data types based on JSON Schema: https://json-schema.org/understanding-json-schema/reference"
    },
    "DecimalSeparator": {
      "type": "string",
      "enum": [".", ","],
      "default": ".",
      "description": "Decimal separator for number parsing. Thousand separators are always removed."
    },
    "Transformation": {
      "type": "string",
      "pattern": "^(uppercase|lowercase|trim|dateFormat:.+|date(:[^:]+)?(:[^:]+)?)$",
      "description": "Value transformations: uppercase, lowercase, trim, date (auto-detect input, output yyyy-MM-dd), date:targetFormat (auto-detect input), date:sourceFormat:targetFormat. Tokens: yyyy, MM, dd, HH, mm, ss. Invalid dates output empty.",
      "examples": ["uppercase", "lowercase", "trim", "date", "date:dd/MM/yyyy", "date:dd/MM/yyyy:yyyy-MM-dd"]
    },
    "ColumnMapping": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "type": "string" }
      },
      "description": "Record<string, string> - source column (key) maps to target column (value)"
    },
    "TypeTransformationMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/DataType" }
      },
      "description": "Record<string, DataType> - column (key) maps to data type (value)"
    },
    "TransformationMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/Transformation" }
      },
      "description": "Record<string, Transformation> - column (key) maps to transformation (value)"
    },
    "ValueConversionMap": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "type": "string" }
      },
      "description": "Record<string, string> - source value (key) maps to target value (value)"
    },
    "ColumnValueConversions": {
      "type": "object",
      "propertyNames": { "type": "string" },
      "patternProperties": {
        ".*": { "$ref": "#/$defs/ValueConversionMap" }
      },
      "description": "Record<string, ValueConversionMap> - column (key) maps to value conversions (value)"
    },
    "SchemaCollection": {
      "type": "object",
      "required": ["$schema", "schemas"],
      "properties": {
        "$schema": {
          "type": "string",
          "description": "Reference to the schema definition"
        },
        "schemas": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Human-readable label for the schema"
              }
            },
            "additionalProperties": true
          },
          "description": "Array of schemas with 'name' as the label property"
        }
      },
      "description": "A collection of schemas identified by 'name' as the label"
    },
    "MappingConfig": {
      "type": "object",
      "required": ["version", "mappings"],
      "properties": {
        "version": {
          "type": "string",
          "const": "1.0",
          "description": "Schema version"
        },
        "inputDelimiter": {
          "$ref": "#/$defs/Delimiter",
          "description": "Delimiter used in the input CSV"
        },
        "outputDelimiter": {
          "$ref": "#/$defs/Delimiter",
          "description": "Delimiter to use in the output CSV"
        },
        "decimalSeparator": {
          "$ref": "#/$defs/DecimalSeparator",
          "description": "Decimal separator for parsing numbers"
        },
        "mappings": {
          "$ref": "#/$defs/ColumnMapping",
          "description": "Column mappings"
        },
        "typeTransformations": {
          "$ref": "#/$defs/TypeTransformationMap",
          "description": "Data type transformations per column"
        },
        "transformations": {
          "$ref": "#/$defs/TransformationMap",
          "description": "Value transformations per column"
        },
        "valueConversions": {
          "$ref": "#/$defs/ColumnValueConversions",
          "description": "Value conversions per column"
        }
      },
      "description": "Mapping configuration object"
    },
    "Mapping": {
      "type": "object",
      "required": ["name", "config"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name/label for the mapping"
        },
        "config": {
          "$ref": "#/$defs/MappingConfig",
          "description": "The mapping configuration"
        }
      },
      "description": "A named mapping configuration for data conversion between systems"
    },
    "MappingCollection": {
      "allOf": [
        { "$ref": "#/$defs/SchemaCollection" },
        {
          "type": "object",
          "properties": {
            "schemas": {
              "items": { "$ref": "#/$defs/Mapping" }
            }
          }
        }
      ],
      "description": "A collection of mapping schemas for data conversion between systems"
    }
  },
  "properties": {
    "version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version"
    },
    "inputDelimiter": {
      "$ref": "#/$defs/Delimiter",
      "description": "Delimiter used in the input CSV"
    },
    "outputDelimiter": {
      "$ref": "#/$defs/Delimiter",
      "description": "Delimiter to use in the output CSV"
    },
    "decimalSeparator": {
      "$ref": "#/$defs/DecimalSeparator",
      "description": "Decimal separator for parsing numbers (. or ,). Thousand separators are always removed."
    },
    "mappings": {
      "$ref": "#/$defs/ColumnMapping",
      "description": "Column mappings. Only columns listed are included in output."
    },
    "typeTransformations": {
      "$ref": "#/$defs/TypeTransformationMap",
      "description": "Data type transformations per column"
    },
    "transformations": {
      "$ref": "#/$defs/TransformationMap",
      "description": "Value transformations per column"
    },
    "valueConversions": {
      "$ref": "#/$defs/ColumnValueConversions",
      "description": "Value conversions per column. Maps specific input values to output values."
    }
  },
  "examples": [
    {
      "version": "1.0",
      "inputDelimiter": ";",
      "outputDelimiter": ";",
      "decimalSeparator": ",",
      "mappings": {
        "id": "ID",
        "title": "gender",
        "name": "fullName",
        "active": "isActive",
        "score": "totalScore",
        "created": "createdDate"
      },
      "typeTransformations": {
        "id": "integer",
        "active": "boolean",
        "score": "number"
      },
      "transformations": {
        "name": "uppercase",
        "created": "date"
      },
      "valueConversions": {
        "title": {
          "Mr": "male",
          "Ms": "female",
          "Mrs": "female"
        }
      }
    }
  ]
}
